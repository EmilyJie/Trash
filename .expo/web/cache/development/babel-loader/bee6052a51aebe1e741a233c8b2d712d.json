{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\NTUE\\\\\\u4E09\\u4E0B\\\\\\u7562\\u903C\\u55F6\\u5C08\\\\\\u7A0B\\u5F0F\\\\trash-project\\\\node_modules\\\\react-native-calendars\\\\src\\\\agenda\\\\index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport memoize from 'memoize-one';\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport { extractComponentProps } from \"../component-updater\";\nimport { parseDate, xdateToData, toMarkingFormat } from \"../interface\";\nimport dateutils from \"../dateutils\";\nimport { AGENDA_CALENDAR_KNOB } from \"../testIDs\";\nimport { VelocityTracker } from \"../input\";\nimport styleConstructor from \"./style\";\nimport CalendarList from \"../calendar-list\";\nimport ReservationList from \"./reservation-list\";\nvar HEADER_HEIGHT = 104;\nvar KNOB_HEIGHT = 24;\n\nvar AgendaView = function (_Component) {\n  _inherits(AgendaView, _Component);\n\n  var _super = _createSuper(AgendaView);\n\n  function AgendaView(props) {\n    var _this;\n\n    _classCallCheck(this, AgendaView);\n\n    _this = _super.call(this, props);\n\n    _this.initialScrollPadPosition = function () {\n      return Math.max(0, _this.viewHeight - HEADER_HEIGHT);\n    };\n\n    _this.setScrollPadPosition = function (y, animated) {\n      if (_this.scrollPad.scrollTo) {\n        _this.scrollPad.scrollTo({\n          x: 0,\n          y: y,\n          animated: animated\n        });\n      } else {\n        _this.scrollPad.getNode().scrollTo({\n          x: 0,\n          y: y,\n          animated: animated\n        });\n      }\n    };\n\n    _this.chooseDayFromCalendar = function (d) {\n      _this.chooseDay(d, !_this.state.calendarScrollable);\n    };\n\n    _this.generateMarkings = memoize(function (selectedDay, markedDates) {\n      var items = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      if (!markedDates) {\n        markedDates = {};\n        Object.keys(items).forEach(function (key) {\n          if (items[key] && items[key].length) {\n            markedDates[key] = {\n              marked: true\n            };\n          }\n        });\n      }\n\n      var key = toMarkingFormat(selectedDay);\n      return _objectSpread(_objectSpread({}, markedDates), {}, _defineProperty({}, key, _objectSpread(_objectSpread({}, markedDates[key] || {}), {\n        selected: true\n      })));\n    });\n\n    _this.onScrollPadLayout = function () {\n      _this.setScrollPadPosition(_this.initialScrollPadPosition(), false);\n\n      setTimeout(function () {\n        return _this.setState({\n          calendarIsReady: true\n        });\n      }, 0);\n    };\n\n    _this.onCalendarListLayout = function () {\n      _this.calendar.scrollToDay(_this.state.selectedDay.clone(), _this.calendarOffset(), false);\n    };\n\n    _this.onLayout = function (event) {\n      _this.viewHeight = event.nativeEvent.layout.height;\n      _this.viewWidth = event.nativeEvent.layout.width;\n\n      _this.forceUpdate();\n    };\n\n    _this.onTouchStart = function () {\n      _this.headerState = 'touched';\n\n      if (_this.knob) {\n        _this.knob.setNativeProps({\n          style: {\n            opacity: 0.5\n          }\n        });\n      }\n    };\n\n    _this.onTouchEnd = function () {\n      if (_this.knob) {\n        _this.knob.setNativeProps({\n          style: {\n            opacity: 1\n          }\n        });\n      }\n\n      if (_this.headerState === 'touched') {\n        _this.setScrollPadPosition(0, true);\n\n        _this.enableCalendarScrolling();\n      }\n\n      _this.headerState = 'idle';\n    };\n\n    _this.onStartDrag = function () {\n      _this.headerState = 'dragged';\n\n      _this.knobTracker.reset();\n    };\n\n    _this.onSnapAfterDrag = function (e) {\n      _this.onTouchEnd();\n\n      var currentY = e.nativeEvent.contentOffset.y;\n\n      _this.knobTracker.add(currentY);\n\n      var projectedY = currentY + _this.knobTracker.estimateSpeed() * 250;\n\n      var maxY = _this.initialScrollPadPosition();\n\n      var snapY = projectedY > maxY / 2 ? maxY : 0;\n\n      _this.setScrollPadPosition(snapY, true);\n\n      if (snapY === 0) {\n        _this.enableCalendarScrolling();\n      }\n    };\n\n    _this.onVisibleMonthsChange = function (months) {\n      _.invoke(_this.props, 'onVisibleMonthsChange', months);\n\n      if (_this.props.items && !_this.state.firstReservationLoad) {\n        clearTimeout(_this.scrollTimeout);\n        _this.scrollTimeout = setTimeout(function () {\n          if (_this._isMounted) {\n            _.invoke(_this.props, 'loadItemsForMonth', months[0]);\n          }\n        }, 200);\n      }\n    };\n\n    _this.onDayChange = function (day) {\n      var newDate = parseDate(day);\n      var withAnimation = dateutils.sameMonth(newDate, _this.state.selectedDay);\n\n      _this.calendar.scrollToDay(day, _this.calendarOffset(), withAnimation);\n\n      _this.setState({\n        selectedDay: newDate\n      });\n\n      _.invoke(_this.props, 'onDayChange', xdateToData(newDate));\n    };\n\n    _this.renderWeekDaysNames = memoize(function (weekDaysNames) {\n      return weekDaysNames.map(function (day, index) {\n        return React.createElement(Text, {\n          allowFontScaling: false,\n          key: day + index,\n          style: _this.style.weekday,\n          numberOfLines: 1,\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 7\n          }\n        }, day);\n      });\n    });\n\n    _this.renderWeekNumbersSpace = function () {\n      return _this.props.showWeekNumbers && React.createElement(View, {\n        allowFontScaling: false,\n        style: _this.style.weekday,\n        numberOfLines: 1,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 42\n        }\n      });\n    };\n\n    _this.style = styleConstructor(props.theme);\n    var windowSize = Dimensions.get('window');\n    _this.viewHeight = windowSize.height;\n    _this.viewWidth = windowSize.width;\n    _this.scrollTimeout = undefined;\n    _this.headerState = 'idle';\n    _this.state = {\n      scrollY: new Animated.Value(0),\n      calendarIsReady: false,\n      calendarScrollable: false,\n      firstReservationLoad: false,\n      selectedDay: parseDate(props.selected) || XDate(true),\n      topDay: parseDate(props.selected) || XDate(true)\n    };\n    _this.currentMonth = _this.state.selectedDay.clone();\n    _this.knobTracker = new VelocityTracker();\n\n    _this.state.scrollY.addListener(function (_ref) {\n      var value = _ref.value;\n      return _this.knobTracker.add(value);\n    });\n\n    return _this;\n  }\n\n  _createClass(AgendaView, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this._isMounted = true;\n      this.loadReservations(this.props);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.state.scrollY.removeAllListeners();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.selected && !dateutils.sameDate(parseDate(this.props.selected), parseDate(prevProps.selected))) {\n        this.setState({\n          selectedDay: parseDate(this.props.selected)\n        });\n      } else if (!prevProps.items) {\n        this.loadReservations(this.props);\n      }\n    }\n  }, {\n    key: \"calendarOffset\",\n    value: function calendarOffset() {\n      return 96 - this.viewHeight / 2;\n    }\n  }, {\n    key: \"enableCalendarScrolling\",\n    value: function enableCalendarScrolling() {\n      this.setState({\n        calendarScrollable: true\n      });\n\n      _.invoke(this.props, 'onCalendarToggled', true);\n\n      this.calendar.scrollToDay(this.state.selectedDay, this.calendarOffset() + 1, true);\n    }\n  }, {\n    key: \"loadReservations\",\n    value: function loadReservations(props) {\n      var _this2 = this;\n\n      if ((!props.items || !Object.keys(props.items).length) && !this.state.firstReservationLoad) {\n        this.setState({\n          firstReservationLoad: true\n        }, function () {\n          _.invoke(_this2.props, 'loadItemsForMonth', xdateToData(_this2.state.selectedDay));\n        });\n      }\n    }\n  }, {\n    key: \"chooseDay\",\n    value: function chooseDay(d, optimisticScroll) {\n      var day = parseDate(d);\n      this.setState({\n        calendarScrollable: false,\n        selectedDay: day.clone()\n      });\n\n      _.invoke(this.props, 'onCalendarToggled', false);\n\n      if (!optimisticScroll) {\n        this.setState({\n          topDay: day.clone()\n        });\n      }\n\n      this.setScrollPadPosition(this.initialScrollPadPosition(), true);\n      this.calendar.scrollToDay(day, this.calendarOffset(), true);\n\n      _.invoke(this.props, 'loadItemsForMonth', xdateToData(day));\n\n      _.invoke(this.props, 'onDayPress', xdateToData(day));\n    }\n  }, {\n    key: \"renderReservations\",\n    value: function renderReservations() {\n      var _this3 = this;\n\n      var reservationListProps = extractComponentProps(ReservationList, this.props);\n      return React.createElement(ReservationList, _extends({}, reservationListProps, {\n        ref: function ref(c) {\n          return _this3.list = c;\n        },\n        reservations: this.props.items,\n        selectedDay: this.state.selectedDay,\n        topDay: this.state.topDay,\n        onDayChange: this.onDayChange,\n        onScroll: function onScroll() {},\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 7\n        }\n      }));\n    }\n  }, {\n    key: \"renderCalendarList\",\n    value: function renderCalendarList() {\n      var _this4 = this;\n\n      var _this$props = this.props,\n          markedDates = _this$props.markedDates,\n          items = _this$props.items;\n      var shouldHideExtraDays = this.state.calendarScrollable ? this.props.hideExtraDays : false;\n      var calendarListProps = extractComponentProps(CalendarList, this.props);\n      return React.createElement(CalendarList, _extends({}, calendarListProps, {\n        ref: function ref(c) {\n          return _this4.calendar = c;\n        },\n        current: this.currentMonth,\n        markedDates: this.generateMarkings(this.state.selectedDay, markedDates, items),\n        calendarWidth: this.viewWidth,\n        scrollEnabled: this.state.calendarScrollable,\n        hideExtraDays: shouldHideExtraDays,\n        onLayout: this.onCalendarListLayout,\n        onDayPress: this.chooseDayFromCalendar,\n        onVisibleMonthsChange: this.onVisibleMonthsChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 7\n        }\n      }));\n    }\n  }, {\n    key: \"renderKnob\",\n    value: function renderKnob() {\n      var _this5 = this;\n\n      var _this$props2 = this.props,\n          hideKnob = _this$props2.hideKnob,\n          renderKnob = _this$props2.renderKnob;\n      var knob = React.createElement(View, {\n        style: this.style.knobContainer,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 16\n        }\n      });\n\n      if (!hideKnob) {\n        var knobView = renderKnob ? renderKnob() : React.createElement(View, {\n          style: this.style.knob,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 52\n          }\n        });\n        knob = this.state.calendarScrollable ? null : React.createElement(View, {\n          style: this.style.knobContainer,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 9\n          }\n        }, React.createElement(View, {\n          ref: function ref(c) {\n            return _this5.knob = c;\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 11\n          }\n        }, knobView));\n      }\n\n      return knob;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var _this$props3 = this.props,\n          firstDay = _this$props3.firstDay,\n          hideKnob = _this$props3.hideKnob,\n          style = _this$props3.style,\n          testID = _this$props3.testID;\n      var weekDaysNames = dateutils.weekDayNames(firstDay);\n      var agendaHeight = this.initialScrollPadPosition();\n      var weekdaysStyle = [this.style.weekdays, {\n        opacity: this.state.scrollY.interpolate({\n          inputRange: [agendaHeight - HEADER_HEIGHT, agendaHeight],\n          outputRange: [0, 1],\n          extrapolate: 'clamp'\n        }),\n        transform: [{\n          translateY: this.state.scrollY.interpolate({\n            inputRange: [Math.max(0, agendaHeight - HEADER_HEIGHT), agendaHeight],\n            outputRange: [-HEADER_HEIGHT, 0],\n            extrapolate: 'clamp'\n          })\n        }]\n      }];\n      var headerTranslate = this.state.scrollY.interpolate({\n        inputRange: [0, agendaHeight],\n        outputRange: [agendaHeight, 0],\n        extrapolate: 'clamp'\n      });\n      var contentTranslate = this.state.scrollY.interpolate({\n        inputRange: [0, agendaHeight],\n        outputRange: [0, agendaHeight / 2],\n        extrapolate: 'clamp'\n      });\n      var headerStyle = [this.style.header, {\n        bottom: agendaHeight,\n        transform: [{\n          translateY: headerTranslate\n        }]\n      }];\n\n      if (!this.state.calendarIsReady) {\n        headerStyle.push({\n          height: 0\n        });\n        weekdaysStyle.push({\n          height: HEADER_HEIGHT\n        });\n      }\n\n      var shouldAllowDragging = !hideKnob && !this.state.calendarScrollable;\n      var scrollPadPosition = (shouldAllowDragging ? HEADER_HEIGHT : 0) - KNOB_HEIGHT;\n      var scrollPadStyle = {\n        position: 'absolute',\n        width: 80,\n        height: KNOB_HEIGHT,\n        top: scrollPadPosition,\n        left: (this.viewWidth - 80) / 2\n      };\n      return React.createElement(View, {\n        testID: testID,\n        onLayout: this.onLayout,\n        style: [style, this.style.container],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 7\n        }\n      }, React.createElement(View, {\n        style: this.style.reservations,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 9\n        }\n      }, this.renderReservations()), React.createElement(Animated.View, {\n        style: headerStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 9\n        }\n      }, React.createElement(Animated.View, {\n        style: [this.style.animatedContainer, {\n          transform: [{\n            translateY: contentTranslate\n          }]\n        }],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }\n      }, this.renderCalendarList()), this.renderKnob()), React.createElement(Animated.View, {\n        style: weekdaysStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 9\n        }\n      }, this.renderWeekNumbersSpace(), this.renderWeekDaysNames(weekDaysNames)), React.createElement(Animated.ScrollView, {\n        ref: function ref(_ref2) {\n          return _this6.scrollPad = _ref2;\n        },\n        style: scrollPadStyle,\n        overScrollMode: \"never\",\n        showsHorizontalScrollIndicator: false,\n        showsVerticalScrollIndicator: false,\n        scrollEventThrottle: 8,\n        scrollsToTop: false,\n        onTouchStart: this.onTouchStart,\n        onTouchEnd: this.onTouchEnd,\n        onScrollBeginDrag: this.onStartDrag,\n        onScrollEndDrag: this.onSnapAfterDrag,\n        onScroll: Animated.event([{\n          nativeEvent: {\n            contentOffset: {\n              y: this.state.scrollY\n            }\n          }\n        }], {\n          useNativeDriver: true\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 9\n        }\n      }, React.createElement(View, {\n        testID: AGENDA_CALENDAR_KNOB,\n        style: {\n          height: agendaHeight + KNOB_HEIGHT\n        },\n        onLayout: this.onScrollPadLayout,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }\n      })));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps) {\n      if (nextProps.items) {\n        return {\n          firstReservationLoad: false\n        };\n      }\n\n      return null;\n    }\n  }]);\n\n  return AgendaView;\n}(Component);\n\nAgendaView.displayName = 'Agenda';\nAgendaView.propTypes = _objectSpread(_objectSpread(_objectSpread({}, CalendarList.propTypes), ReservationList.propTypes), {}, {\n  style: PropTypes.oneOfType([PropTypes.object, PropTypes.array, PropTypes.number]),\n  items: PropTypes.object,\n  loadItemsForMonth: PropTypes.func,\n  onCalendarToggled: PropTypes.func,\n  onDayPress: PropTypes.func,\n  onDaychange: PropTypes.func,\n  renderKnob: PropTypes.func,\n  selected: PropTypes.any,\n  hideKnob: PropTypes.bool\n});\nexport { AgendaView as default };","map":{"version":3,"sources":["C:/Users/User/Desktop/NTUE/三下/畢逼嗶專/程式/trash-project/node_modules/react-native-calendars/src/agenda/index.js"],"names":["_","PropTypes","XDate","memoize","React","Component","extractComponentProps","parseDate","xdateToData","toMarkingFormat","dateutils","AGENDA_CALENDAR_KNOB","VelocityTracker","styleConstructor","CalendarList","ReservationList","HEADER_HEIGHT","KNOB_HEIGHT","AgendaView","props","initialScrollPadPosition","Math","max","viewHeight","setScrollPadPosition","y","animated","scrollPad","scrollTo","x","getNode","chooseDayFromCalendar","d","chooseDay","state","calendarScrollable","generateMarkings","selectedDay","markedDates","items","Object","keys","forEach","key","length","marked","selected","onScrollPadLayout","setTimeout","setState","calendarIsReady","onCalendarListLayout","calendar","scrollToDay","clone","calendarOffset","onLayout","event","nativeEvent","layout","height","viewWidth","width","forceUpdate","onTouchStart","headerState","knob","setNativeProps","style","opacity","onTouchEnd","enableCalendarScrolling","onStartDrag","knobTracker","reset","onSnapAfterDrag","e","currentY","contentOffset","add","projectedY","estimateSpeed","maxY","snapY","onVisibleMonthsChange","months","invoke","firstReservationLoad","clearTimeout","scrollTimeout","_isMounted","onDayChange","day","newDate","withAnimation","sameMonth","renderWeekDaysNames","weekDaysNames","map","index","weekday","renderWeekNumbersSpace","showWeekNumbers","theme","windowSize","Dimensions","get","undefined","scrollY","Animated","Value","topDay","currentMonth","addListener","value","loadReservations","removeAllListeners","prevProps","sameDate","optimisticScroll","reservationListProps","c","list","shouldHideExtraDays","hideExtraDays","calendarListProps","hideKnob","renderKnob","knobContainer","knobView","firstDay","testID","weekDayNames","agendaHeight","weekdaysStyle","weekdays","interpolate","inputRange","outputRange","extrapolate","transform","translateY","headerTranslate","contentTranslate","headerStyle","header","bottom","push","shouldAllowDragging","scrollPadPosition","scrollPadStyle","position","top","left","container","reservations","renderReservations","animatedContainer","renderCalendarList","ref","useNativeDriver","nextProps","displayName","propTypes","oneOfType","object","array","number","loadItemsForMonth","func","onCalendarToggled","onDayPress","onDaychange","any","bool"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport memoize from 'memoize-one';\n\nimport React, {Component} from 'react';\nimport {Text, View, Dimensions, Animated} from 'react-native';\n\nimport {extractComponentProps} from '../component-updater';\nimport {parseDate, xdateToData, toMarkingFormat} from '../interface';\nimport dateutils from '../dateutils';\nimport {AGENDA_CALENDAR_KNOB} from '../testIDs';\nimport {VelocityTracker} from '../input';\nimport styleConstructor from './style';\nimport CalendarList from '../calendar-list';\nimport ReservationList from './reservation-list';\n\nconst HEADER_HEIGHT = 104;\nconst KNOB_HEIGHT = 24;\n\n/**\n * @description: Agenda component\n * @extends: CalendarList\n * @extendslink: docs/CalendarList\n * @example: https://github.com/wix/react-native-calendars/blob/master/example/src/screens/agenda.js\n * @gif: https://github.com/wix/react-native-calendars/blob/master/demo/agenda.gif\n */\nexport default class AgendaView extends Component {\n  static displayName = 'Agenda';\n\n  static propTypes = {\n    ...CalendarList.propTypes,\n    ...ReservationList.propTypes,\n    /** agenda container style */\n    style: PropTypes.oneOfType([PropTypes.object, PropTypes.array, PropTypes.number]),\n    /** the list of items that have to be displayed in agenda. If you want to render item as empty date\n     the value of date key has to be an empty array []. If there exists no value for date key it is\n     considered that the date in question is not yet loaded */\n    items: PropTypes.object,\n    /** callback that gets called when items for a certain month should be loaded (month became visible) */\n    loadItemsForMonth: PropTypes.func,\n    /** callback that fires when the calendar is opened or closed */\n    onCalendarToggled: PropTypes.func,\n    /** callback that gets called on day press */\n    onDayPress: PropTypes.func,\n    /** callback that gets called when day changes while scrolling agenda list */\n    onDaychange: PropTypes.func, //TODO: Should be renamed 'onDayChange'\n    /** specify how agenda knob should look like */\n    renderKnob: PropTypes.func,\n    /** initially selected day */\n    selected: PropTypes.any, //TODO: Should be renamed 'selectedDay'\n    /** Hide knob button. Default = false */\n    hideKnob: PropTypes.bool\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.style = styleConstructor(props.theme);\n\n    const windowSize = Dimensions.get('window');\n    this.viewHeight = windowSize.height;\n    this.viewWidth = windowSize.width;\n\n    this.scrollTimeout = undefined;\n    this.headerState = 'idle';\n\n    this.state = {\n      scrollY: new Animated.Value(0),\n      calendarIsReady: false,\n      calendarScrollable: false,\n      firstReservationLoad: false,\n      selectedDay: parseDate(props.selected) || XDate(true),\n      topDay: parseDate(props.selected) || XDate(true)\n    };\n\n    this.currentMonth = this.state.selectedDay.clone();\n\n    this.knobTracker = new VelocityTracker();\n    this.state.scrollY.addListener(({value}) => this.knobTracker.add(value));\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n    this.loadReservations(this.props);\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n    this.state.scrollY.removeAllListeners();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.selected && !dateutils.sameDate(parseDate(this.props.selected), parseDate(prevProps.selected))) {\n      this.setState({selectedDay: parseDate(this.props.selected)});\n    } else if (!prevProps.items) {\n      this.loadReservations(this.props);\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps) {\n    if (nextProps.items) {\n      return {firstReservationLoad: false};\n    }\n\n    return null;\n  }\n\n  calendarOffset() {\n    return 96 - this.viewHeight / 2;\n  }\n\n  initialScrollPadPosition = () => {\n    return Math.max(0, this.viewHeight - HEADER_HEIGHT);\n  };\n\n  setScrollPadPosition = (y, animated) => {\n    if (this.scrollPad.scrollTo) {\n      this.scrollPad.scrollTo({x: 0, y, animated});\n    } else {\n      // Support for RN O.61 (Expo 37)\n      this.scrollPad.getNode().scrollTo({x: 0, y, animated});\n    }\n  };\n\n  enableCalendarScrolling() {\n    this.setState({\n      calendarScrollable: true\n    });\n\n    _.invoke(this.props, 'onCalendarToggled', true);\n\n    // Enlarge calendarOffset here as a workaround on iOS to force repaint.\n    // Otherwise the month after current one or before current one remains invisible.\n    // The problem is caused by overflow: 'hidden' style, which we need for dragging\n    // to be performant.\n    // Another working solution for this bug would be to set removeClippedSubviews={false}\n    // in CalendarList listView, but that might impact performance when scrolling\n    // month list in expanded CalendarList.\n    // Further info https://github.com/facebook/react-native/issues/1831\n    this.calendar.scrollToDay(this.state.selectedDay, this.calendarOffset() + 1, true);\n  }\n\n  loadReservations(props) {\n    if ((!props.items || !Object.keys(props.items).length) && !this.state.firstReservationLoad) {\n      this.setState(\n        {\n          firstReservationLoad: true\n        },\n        () => {\n          _.invoke(this.props, 'loadItemsForMonth', xdateToData(this.state.selectedDay));\n        }\n      );\n    }\n  }\n\n  chooseDayFromCalendar = d => {\n    this.chooseDay(d, !this.state.calendarScrollable);\n  };\n\n  chooseDay(d, optimisticScroll) {\n    const day = parseDate(d);\n\n    this.setState({\n      calendarScrollable: false,\n      selectedDay: day.clone()\n    });\n\n    _.invoke(this.props, 'onCalendarToggled', false);\n\n    if (!optimisticScroll) {\n      this.setState({\n        topDay: day.clone()\n      });\n    }\n\n    this.setScrollPadPosition(this.initialScrollPadPosition(), true);\n    this.calendar.scrollToDay(day, this.calendarOffset(), true);\n\n    _.invoke(this.props, 'loadItemsForMonth', xdateToData(day));\n    _.invoke(this.props, 'onDayPress', xdateToData(day));\n  }\n\n  generateMarkings = memoize((selectedDay, markedDates, items = {}) => {\n    if (!markedDates) {\n      markedDates = {};\n      Object.keys(items).forEach(key => {\n        if (items[key] && items[key].length) {\n          markedDates[key] = {marked: true};\n        }\n      });\n    }\n\n    const key = toMarkingFormat(selectedDay);\n    return {...markedDates, [key]: {...(markedDates[key] || {}), ...{selected: true}}};\n  });\n\n  onScrollPadLayout = () => {\n    // When user touches knob, the actual component that receives touch events is a ScrollView.\n    // It needs to be scrolled to the bottom, so that when user moves finger downwards,\n    // scroll position actually changes (it would stay at 0, when scrolled to the top).\n    this.setScrollPadPosition(this.initialScrollPadPosition(), false);\n    // delay rendering calendar in full height because otherwise it still flickers sometimes\n    setTimeout(() => this.setState({calendarIsReady: true}), 0);\n  };\n\n  onCalendarListLayout = () => {\n    this.calendar.scrollToDay(this.state.selectedDay.clone(), this.calendarOffset(), false);\n  };\n\n  onLayout = event => {\n    this.viewHeight = event.nativeEvent.layout.height;\n    this.viewWidth = event.nativeEvent.layout.width;\n    this.forceUpdate();\n  };\n\n  onTouchStart = () => {\n    this.headerState = 'touched';\n    if (this.knob) {\n      this.knob.setNativeProps({style: {opacity: 0.5}});\n    }\n  };\n\n  onTouchEnd = () => {\n    if (this.knob) {\n      this.knob.setNativeProps({style: {opacity: 1}});\n    }\n\n    if (this.headerState === 'touched') {\n      this.setScrollPadPosition(0, true);\n      this.enableCalendarScrolling();\n    }\n\n    this.headerState = 'idle';\n  };\n\n  onStartDrag = () => {\n    this.headerState = 'dragged';\n    this.knobTracker.reset();\n  };\n\n  onSnapAfterDrag = e => {\n    // on Android onTouchEnd is not called if dragging was started\n    this.onTouchEnd();\n    const currentY = e.nativeEvent.contentOffset.y;\n    this.knobTracker.add(currentY);\n    const projectedY = currentY + this.knobTracker.estimateSpeed() * 250; /*ms*/\n    const maxY = this.initialScrollPadPosition();\n    const snapY = projectedY > maxY / 2 ? maxY : 0;\n    this.setScrollPadPosition(snapY, true);\n\n    if (snapY === 0) {\n      this.enableCalendarScrolling();\n    }\n  };\n\n  onVisibleMonthsChange = months => {\n    _.invoke(this.props, 'onVisibleMonthsChange', months);\n\n    if (this.props.items && !this.state.firstReservationLoad) {\n      clearTimeout(this.scrollTimeout);\n\n      this.scrollTimeout = setTimeout(() => {\n        if (this._isMounted) {\n          _.invoke(this.props, 'loadItemsForMonth', months[0]);\n        }\n      }, 200);\n    }\n  };\n\n  onDayChange = day => {\n    const newDate = parseDate(day);\n    const withAnimation = dateutils.sameMonth(newDate, this.state.selectedDay);\n\n    this.calendar.scrollToDay(day, this.calendarOffset(), withAnimation);\n    this.setState({\n      selectedDay: newDate\n    });\n\n    _.invoke(this.props, 'onDayChange', xdateToData(newDate));\n  };\n\n  renderReservations() {\n    const reservationListProps = extractComponentProps(ReservationList, this.props);\n\n    return (\n      <ReservationList\n        {...reservationListProps}\n        ref={c => (this.list = c)}\n        reservations={this.props.items}\n        selectedDay={this.state.selectedDay}\n        topDay={this.state.topDay}\n        onDayChange={this.onDayChange}\n        onScroll={() => {}}\n      />\n    );\n  }\n\n  renderCalendarList() {\n    const {markedDates, items} = this.props;\n    const shouldHideExtraDays = this.state.calendarScrollable ? this.props.hideExtraDays : false;\n    const calendarListProps = extractComponentProps(CalendarList, this.props);\n\n    return (\n      <CalendarList\n        {...calendarListProps}\n        ref={c => (this.calendar = c)}\n        current={this.currentMonth}\n        markedDates={this.generateMarkings(this.state.selectedDay, markedDates, items)}\n        calendarWidth={this.viewWidth}\n        scrollEnabled={this.state.calendarScrollable}\n        hideExtraDays={shouldHideExtraDays}\n        onLayout={this.onCalendarListLayout}\n        onDayPress={this.chooseDayFromCalendar}\n        onVisibleMonthsChange={this.onVisibleMonthsChange}\n      />\n    );\n  }\n\n  renderKnob() {\n    const {hideKnob, renderKnob} = this.props;\n    let knob = <View style={this.style.knobContainer} />;\n\n    if (!hideKnob) {\n      const knobView = renderKnob ? renderKnob() : <View style={this.style.knob} />;\n      knob = this.state.calendarScrollable ? null : (\n        <View style={this.style.knobContainer}>\n          <View ref={c => (this.knob = c)}>{knobView}</View>\n        </View>\n      );\n    }\n    return knob;\n  }\n\n  renderWeekDaysNames = memoize(weekDaysNames => {\n    return weekDaysNames.map((day, index) => (\n      <Text allowFontScaling={false} key={day + index} style={this.style.weekday} numberOfLines={1}>\n        {day}\n      </Text>\n    ));\n  });\n\n  renderWeekNumbersSpace = () => {\n    return this.props.showWeekNumbers && <View allowFontScaling={false} style={this.style.weekday} numberOfLines={1} />;\n  };\n\n  render() {\n    const {firstDay, hideKnob, style, testID} = this.props;\n    const weekDaysNames = dateutils.weekDayNames(firstDay);\n    const agendaHeight = this.initialScrollPadPosition();\n    const weekdaysStyle = [\n      this.style.weekdays,\n      {\n        opacity: this.state.scrollY.interpolate({\n          inputRange: [agendaHeight - HEADER_HEIGHT, agendaHeight],\n          outputRange: [0, 1],\n          extrapolate: 'clamp'\n        }),\n        transform: [\n          {\n            translateY: this.state.scrollY.interpolate({\n              inputRange: [Math.max(0, agendaHeight - HEADER_HEIGHT), agendaHeight],\n              outputRange: [-HEADER_HEIGHT, 0],\n              extrapolate: 'clamp'\n            })\n          }\n        ]\n      }\n    ];\n    const headerTranslate = this.state.scrollY.interpolate({\n      inputRange: [0, agendaHeight],\n      outputRange: [agendaHeight, 0],\n      extrapolate: 'clamp'\n    });\n    const contentTranslate = this.state.scrollY.interpolate({\n      inputRange: [0, agendaHeight],\n      outputRange: [0, agendaHeight / 2],\n      extrapolate: 'clamp'\n    });\n    const headerStyle = [\n      this.style.header,\n      {\n        bottom: agendaHeight,\n        transform: [{translateY: headerTranslate}]\n      }\n    ];\n\n    if (!this.state.calendarIsReady) {\n      // limit header height until everything is setup for calendar dragging\n      headerStyle.push({height: 0});\n      // fill header with appStyle.calendarBackground background to reduce flickering\n      weekdaysStyle.push({height: HEADER_HEIGHT});\n    }\n\n    const shouldAllowDragging = !hideKnob && !this.state.calendarScrollable;\n    const scrollPadPosition = (shouldAllowDragging ? HEADER_HEIGHT : 0) - KNOB_HEIGHT;\n    const scrollPadStyle = {\n      position: 'absolute',\n      width: 80,\n      height: KNOB_HEIGHT,\n      top: scrollPadPosition,\n      left: (this.viewWidth - 80) / 2\n    };\n\n    return (\n      <View testID={testID} onLayout={this.onLayout} style={[style, this.style.container]}>\n        <View style={this.style.reservations}>{this.renderReservations()}</View>\n        <Animated.View style={headerStyle}>\n          <Animated.View style={[this.style.animatedContainer, {transform: [{translateY: contentTranslate}]}]}>\n            {this.renderCalendarList()}\n          </Animated.View>\n          {this.renderKnob()}\n        </Animated.View>\n        <Animated.View style={weekdaysStyle}>\n          {this.renderWeekNumbersSpace()}\n          {this.renderWeekDaysNames(weekDaysNames)}\n        </Animated.View>\n        <Animated.ScrollView\n          ref={ref => (this.scrollPad = ref)}\n          style={scrollPadStyle}\n          overScrollMode=\"never\"\n          showsHorizontalScrollIndicator={false}\n          showsVerticalScrollIndicator={false}\n          scrollEventThrottle={8}\n          scrollsToTop={false}\n          onTouchStart={this.onTouchStart}\n          onTouchEnd={this.onTouchEnd}\n          onScrollBeginDrag={this.onStartDrag}\n          onScrollEndDrag={this.onSnapAfterDrag}\n          onScroll={Animated.event([{nativeEvent: {contentOffset: {y: this.state.scrollY}}}], {useNativeDriver: true})}\n        >\n          <View\n            testID={AGENDA_CALENDAR_KNOB}\n            style={{height: agendaHeight + KNOB_HEIGHT}}\n            onLayout={this.onScrollPadLayout}\n          />\n        </Animated.ScrollView>\n      </View>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}